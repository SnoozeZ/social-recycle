<% provide(:title, @item.title) %>
<div class="container-fluid" xmlns:style="http://www.w3.org/1999/xhtml">
  <div class="row">
    <div class="col-xs-6">
      <div class="container">
        <%= image_tag(@item.avatar_url(:large), class: "img-rounded", style: "height: 400px") if @item.avatar? %>
      </div>

    </div>
    <div class="col-xs-6">
      <h1><%= @item.title %></h1>
      <p><span style="font-weight : bold"> Expired at: </span><%= @item.timeout %>
      <p><span style="font-weight : bold"> Category: </span><%= @item.category.name %></p>
      <p><span style="font-weight : bold"> Giver: </span><%= link_to @item.user.username, @item.user %></p>
      <p><span style="font-weight : bold"> Descrition: </span><%= @item.description %></p>

      <% id = @item.id %>
      <% uid = @item.user_id %>

      <div class="col-md-6 col-md-offset-3" style="margin-top:30px;">
        <% if logged_in? %>
            <% if current_user.id != uid #if the current user is not the giver of the item, display the button%>
                <% if !current_user.dibs.exists?(:item_id => id) %>
                    <%= button_to "I Want!", {:controller => "dibs", :action => "create", :dib=> {:item_id => id, :user_id => current_user.id}}, :method => :post, class: "btn btn-success", style: "width: 100%" %>
                <% else %>
                    <%= button_to "Withdraw!", {:controller => "dibs", :action => "destroy", :dib => {:item_id => id, :user_id => current_user.id}}, class: "btn btn-danger", style: "width: 100%" %>
                <% end %>
            <% end %>
        <% else %>
            <%= link_to "I Want!", signin_path, class: "btn btn-success", style: "width: 100%"%>
        <% end %>
      </div>
    </div>

    <% if logged_in? %>
        <% if current_user.id == uid %>
            <div class="container" style="margin-top:20px;">
              <table class="table">
                <thead>
                <tr>
                  <th> Choose one to give!</th>
                  <th colspan="1"></th>
                </tr>
                </thead>
                <tbody>
                <% @item.passive_dibs.each do |who| %>
                    <tr>
                      <td><%= link_to(User.find(who.user_id).username, user_path(uid)) %></td>
                      <td><%= button_to("Give!", {:controller => "dibs", :action => "give", :dib => {:item_id => id, :user_id => uid}}, class: "btn btn-default btn-xs", data: { confirm:"Give to " + User.find(who.user_id).username + ", are you sure?"}) %></td>
                    </tr>
                <% end %>
                </tbody>
              </table>
            </div>
        <% end %>
    <% end %>
  </div>
</div>

